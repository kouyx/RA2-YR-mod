# YR Mod Tutorial Basics

> 原标题《一些入门基础知识》

## ts平台(也称游戏引擎)介绍

> ra2的游戏主程序由c&c2泰伯利亚之日平台修改而来，和ts相比区别不大。熟悉ra2平台的人一定可以看得懂ts的代码。两者的差距在于游戏内容上。通称ts平台。尤里复仇不过是在ts平台改版上的又一次修改，本质还是ts引擎。

> 尤里平台上还有修改，英国的RockPatch，通称rp平台和之后的NPatch，通称np平台。np又有秋季版npae和特别版npse。最后最新一代是中国的np extension 172，目前已经停止更新并不再受理bug反馈。因为红警2平台的局限性，现在的mod基本都是尤里和更高级平台上的。

> **游戏平台**通常指ra2的game.exe，尤里复仇的gamemd.exe(md，mission disk)。平台的局限性要有所了解，才可以根据平台来实现设定。

## 游戏资源读取

> mix是westwood的游戏素材包，就像暴雪的mpq文件，可以简单当作rar压缩包。当然，winrar是打不开mix文件的。专用于ts平台mod开发的工具是xcc系列。将素材解压，就可以用专门的素材处理软件处理了。如果要修改ini，更加简单，提取到游戏根目录，记事本修改后保存，对游戏内容有立竿见影的效果。

> 游戏的各种资源读取顺序是首先地图覆盖游戏目录的ini（可以说地图是整个平台里优先级最高的ini——地图就是ini，可以用记事本写字板之类打开，你会发现很多熟悉的代码，在地图里编辑单位的方法和编辑一般ini的方法并无不同）；游戏根目录ini覆盖所有mix文件的ini；expand(md)，ecache(md)这两类扩展mix覆盖原装mix所有同名内容。

> 提倡所有注册名第一个字母大写，其他部分参考原注册表的大小写格式。注册名不得带有空格。

## 游戏资源简介

> 游戏内容由各种资源决定。尤里的ini和mix文件名都比原版多出了md二字，某些尤里专有内容只有在md的mix和ini中才能生效。图像素材只要注册就可以使用。

### ini体系

- rules：基础之基础。Rules中设定了所有单位的图形，生命，武器，价格等等数据
- art：游戏内部图像设定，语句很少，体系简单。在此注册素材和碎片，设置粒子关联和导弹尾烟，也是一些特殊武器的重点部位
- ai：AI出什么部队在此设定，而AI出什么建筑由建筑本身AIBuildThis决定
  > 注意，原版平台存在100单位bug，步兵不能超过100，车辆不能超过200
- sound：定义游戏内声音的ini，只要照抄原有内容即可。复制粘贴改名是基本能力
- eva：对指挥官的语音播报

### 其他素材

- glslmd: 载入画面，对应色盘是glsmd.pal。高质量载入图片的制作方法参考[此处](https://tieba.baidu.com/f?kz=1013755765)。
- wav：声音素材，采样率352KBPS，单声道，22KHz。建议打开原始的一段音频，修改内容并重命名。必须打包进audio.bag。xcc mixer-launch-xcc sound editor可以打开声音包。拖进去并在sound中注册。
- shp和vxl：图像素材。新素材在使用之前必须在art中注册。注册方式参考原版素材。
  > 游戏内动画，步兵，建筑，炮弹和蜘蛛的图形文件。本质是索引，需要对应的色盘。色盘是.pal文件，photoshop可以生成，但是和红警的色盘不一样。xcc mixer自动载入色盘的快捷键是ctrl+q，或者手工选择。不同于vxl的缩放，shp的缩放是不可逆的，因为直接改变了素材本身，vxl的缩放只是设定了游戏中的显示方式。

  > 游戏原版rules里很多单位并没有写Image=，因为rules注册名和art注册名相同，便直接调用了。如果不同，则必须写明Image=
- vxl：游戏内绝大多数车辆，所有飞机和少部分碎片的图形文件。简单VXL教程可参考[此处](https://tieba.baidu.com/f?kz=690182833)
  > 假3d，因为基本构成是点，真3d基本构成是平面。vxl可以简单看作堆好的像素积木。作为积木，游戏需要了解各个组件在游戏中如何放置组合。用设定软件设定。同时也可以设定vxl动画，炮塔位置和在游戏中的缩放。

  > 一切新的VXL素材的引入都必须有一个配套的HVA来标定在游戏中的显示方式，否则无法显示。VXL单位的动画在HVA中设定。此外，注册为aircraft的所有单位的素材都必须是VXL。

  > 单位炮塔的调用是通过游戏自动配对的，假如一个vxl素材叫ooooo.vxl,那么它的炮塔就是oooootur.vxl，炮管是ooooobarl.vxl。

  > 建筑炮塔则是专门的语句设定，参考哨戒炮。建筑使用SHP炮塔的话，SHP炮塔需要在ART里注册，并在rules的animation注册表中注册。

- ra2(md).csf，用专门的语言编辑器修改。任何单位都有一句UIName=为其在CSF文件里的条目名，修改此条目的内容就可以修改游戏中显示的名字。

### 动画

覆盖物：矿石，弹坑。

矿石的价值是25，宝石价值是50，搜索Value=25可以在ini快结尾的地方找到矿石的价值，附近就是宝石。矿车单位时间采矿的数量是内定的，不存在任何可以修改的语句。

围墙是一种覆盖物，也是一种建筑。围墙的ART里可以看到变成覆盖物的语句。宝箱也是覆盖物。

### 粒子系统设定

什么是粒子？病毒狙击手的病毒云，共辉里中国喷火碉堡的火焰，ifv维修时的火花，就是粒子。
轨道炮系统的解释参考[此处](https://tieba.baidu.com/f?kz=865014555)

粒子系统的调用方法：

- 关联在武器上直接输出，如轨道炮，火焰，火花，在武器代码中。
- 关联在建筑和单位上，如矿场和坦克冒烟，直接在建筑和坦克中设定。
- 关联动画，如病毒巨鸡手打死步兵后播放的动画结束后会刷出两个粒子。在art中设定。

### 武器系统

武器系统是ini的最大亮点，难点，武器基本可以随意装载到任何单位上，并不受单位类型的限制。少数例外可以自己尝试。一切攻击有关的代码，都在武器系统，而非单位里，除了极少数稀有的非常规单位外。武器在单位和建筑中的引用是primary=，secondary=，eliteprimary=，elitesecondary=，deathweapon=。盖特是一套独立系统。

### 超武设置

超武并非单纯的六大阵营超武。伞兵，侦察机，都是超武。所谓超武，最科学的说法是所有注册入超武注册表的代码段。直观说来，所有在武器栏出现，需要倒计时，可以在全图释放的东西都是超武。

超武也就是代码多，并无系统架构上的费解处。超武的调用方法是建筑代码superweapon=和superweapon2=。

一个超武必须对应一个独立的action鼠标动作，一个action也只能对应一个超武。

## IE

关于弹框：正式说法是internal error，简称ie，就是弹框踢出。

ie是mod开发中必定会经过的环节。发生ie基本都是因为ini编写的不完善，所以发生一次ie就应当立刻修正ini，否则ie仍然会在那个时候发生。

eip表参考[此处](https://www.modenc.renegadeprojects.com/Internal_Error)。